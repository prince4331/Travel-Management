(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257,152],{9442:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/groups/create",function(){return r(3002)}])},1027:function(e,t,r){"use strict";r.d(t,{C:function(){return a}});var s=r(5893),n=r(801);let i={default:"bg-slate-100 text-slate-700",success:"bg-emerald-100 text-emerald-700",warning:"bg-amber-100 text-amber-700",danger:"bg-red-100 text-red-700",info:"bg-blue-100 text-blue-700"};function a(e){let{className:t,variant:r="default",...a}=e;return(0,s.jsx)("span",{className:(0,n.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",i[r],t),...a})}},2417:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var s=r(5893),n=r(7294),i=r(801);let a={primary:"bg-primary-600 text-white hover:bg-primary-700",secondary:"border border-primary-600 text-primary-600 hover:bg-primary-50",subtle:"bg-slate-100 text-slate-700 hover:bg-slate-200",ghost:"text-slate-600 hover:bg-slate-100",danger:"bg-red-600 text-white hover:bg-red-700"},l={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-base"},o=n.forwardRef((e,t)=>{let{as:r="button",asChild:n,href:o,className:d,variant:u="primary",size:c="md",loadingText:m,isLoading:p,disabled:y,children:x,...f}=e,g=(0,i.cn)("inline-flex items-center justify-center rounded-md font-medium transition focus:outline-none focus:ring-2 focus:ring-primary-200 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60",a[u],l[c],d),{form:h,formAction:b,formEncType:v,formMethod:j,formNoValidate:w,formTarget:N,type:D,value:S,...T}=f;return"a"===r?(0,s.jsx)("a",{ref:t,href:o,className:g,"aria-disabled":y||p,...T,children:p?null!=m?m:"Loading...":x}):(0,s.jsx)("button",{ref:t,disabled:y||p,className:g,...f,children:p?null!=m?m:"Loading...":x})});o.displayName="Button"},8701:function(e,t,r){"use strict";r.d(t,{xH:function(){return g},Qc:function(){return b},mm:function(){return x},CB:function(){return w},Ui:function(){return D},i4:function(){return j},hA:function(){return v},xR:function(){return y},RW:function(){return p},Iw:function(){return f},D0:function(){return N},er:function(){return h}});var s=r(3934),n=r(202),i=r(8029),a=r(8111),l=r(6471);let o=e=>{var t,r,s,n;return{id:e.user.id,email:e.user.email,phone:e.user.phone,photoUrl:null!==(t=e.user.photoUrl)&&void 0!==t?t:null,bloodGroup:null!==(r=e.user.bloodGroup)&&void 0!==r?r:null,emergencyContact:null!==(s=e.user.emergencyContact)&&void 0!==s?s:null,createdAt:e.joinedAt,role:null,displayName:null!==(n=e.displayName)&&void 0!==n?n:e.user.email,status:e.status}},d=(e,t)=>{var r;return{id:String(t.id),groupId:e,title:t.title,description:null!==(r=t.description)&&void 0!==r?r:void 0,category:t.category,currency:t.currency,amount:t.amount,splits:t.splits.map(e=>({memberId:e.memberId,amount:e.amount})),paidBy:t.paidBy.id,incurredOn:t.incurredOn,receiptUrl:void 0,attachments:[],createdAt:t.createdAt}},u=e=>{var t,r;return{id:String(e.id),ownerType:e.ownerType,ownerId:e.ownerId,groupId:"group"===e.ownerType?String(e.ownerId):void 0,title:e.title,description:null!==(t=e.description)&&void 0!==t?t:void 0,fileType:e.fileType,fileSize:e.fileSize,storageKey:e.storageKey,expiresAt:null!==(r=e.expiresAt)&&void 0!==r?r:void 0,createdAt:e.createdAt,createdBy:e.createdBy.id,isEncrypted:e.isEncrypted}},c=e=>{var t,r;return{id:String(e.id),code:e.code,expiresAt:null!==(t=e.expiresAt)&&void 0!==t?t:void 0,usageLimit:null!==(r=e.usageLimit)&&void 0!==r?r:void 0,usedCount:e.usedCount,createdAt:e.createdAt,createdBy:e.createdBy.id}},m=e=>{var t,r,s,n,i,a,l;let m=String(e.id),p=e.members.map(o),y=e.expenses.map(e=>d(m,e)),x=e.documents.map(u);return{id:m,title:e.title,description:null!==(t=e.description)&&void 0!==t?t:void 0,destination:e.destination,startDate:e.startDate,endDate:e.endDate,isPublic:e.isPublic,inviteCode:e.inviteCode,coverImage:null!==(r=e.coverImage)&&void 0!==r?r:void 0,guides:null!==(s=e.guides)&&void 0!==s?s:[],tags:null!==(n=e.tags)&&void 0!==n?n:[],createdAt:e.createdAt,updatedAt:e.updatedAt,admins:e.members.filter(e=>"admin"===e.role||"co-admin"===e.role).map(e=>e.user.id),financeSummary:{totalExpenses:e.financeSummary.totalExpenses,totalMembers:e.financeSummary.totalMembers,outstandingBalance:e.financeSummary.outstandingBalance},offlinePackages:null!==(i=e.offlinePackages)&&void 0!==i?i:[],members:p,documents:x,itinerary:null!==(a=e.itinerary)&&void 0!==a?a:[],emergencyContacts:null!==(l=e.emergencyContacts)&&void 0!==l?l:[],invites:e.invites.map(c),expenses:y}},p=()=>{let{authFetch:e}=(0,a.a)(),t=(0,l.q)(e=>e.setGroups);return(0,s.a)({queryKey:["groups"],queryFn:async()=>{let r=(await e("/groups")).map(m);return t(r),r},staleTime:3e4})},y=e=>{let{authFetch:t}=(0,a.a)(),r=(0,l.q)(e=>e.setGroup);return(0,s.a)({queryKey:["groups",e],enabled:!!e,queryFn:async()=>{let s=m(await t("/groups/".concat(e)));return r(s),s},staleTime:3e4})},x=()=>{let{authFetch:e}=(0,a.a)(),t=(0,l.q)(e=>e.setGroup),r=(0,n.NL)();return(0,i.D)({mutationFn:async t=>m(await e("/groups",{method:"POST",body:JSON.stringify(t)})),onSuccess:e=>{t(e),r.invalidateQueries({queryKey:["groups"]}),r.invalidateQueries({queryKey:["groups",e.id]})}})},f=e=>{let{authFetch:t}=(0,a.a)(),r=(0,n.NL)();return(0,i.D)({mutationFn:async r=>await t("/groups/".concat(e,"/invite"),{method:"POST",body:JSON.stringify(r)}),onSuccess:()=>{r.invalidateQueries({queryKey:["groups",e]}),r.invalidateQueries({queryKey:["groups"]})}})},g=e=>{let{authFetch:t}=(0,a.a)(),r=(0,n.NL)();return(0,i.D)({mutationFn:async r=>await t("/groups/".concat(e,"/members"),{method:"POST",body:JSON.stringify(r)}),onSuccess:()=>{r.invalidateQueries({queryKey:["groups",e]}),r.invalidateQueries({queryKey:["groups"]})}})},h=e=>{let{authFetch:t}=(0,a.a)(),r=(0,n.NL)();return(0,i.D)({mutationFn:async r=>(await t("/groups/".concat(e,"/members/").concat(r),{method:"DELETE"}),r),onSuccess:()=>{r.invalidateQueries({queryKey:["groups",e]}),r.invalidateQueries({queryKey:["groups"]})}})},b=e=>{let{authFetch:t}=(0,a.a)(),r=(0,n.NL)();return(0,i.D)({mutationFn:async r=>{if(!e)throw Error("Group id is required to create an expense");return t("/groups/".concat(e,"/expenses"),{method:"POST",body:JSON.stringify(r)})},onSuccess:(t,s,n)=>(e&&(r.invalidateQueries({queryKey:["groups",e]}),r.invalidateQueries({queryKey:["groups",e,"expenses"]}),r.invalidateQueries({queryKey:["groups",e,"balance"]}),r.invalidateQueries({queryKey:["groups"]})),n)})},v=e=>{let{authFetch:t}=(0,a.a)();return(0,s.a)({queryKey:["groups",e,"expenses"],enabled:!!e,queryFn:async()=>e?(await t("/groups/".concat(e,"/expenses"))).map(t=>d(e,t)):[],staleTime:15e3})},j=e=>{let{authFetch:t}=(0,a.a)();return(0,s.a)({queryKey:["groups",e,"balance"],enabled:!!e,queryFn:async()=>e?await t("/groups/".concat(e,"/balance")):null,staleTime:15e3})},w=()=>{let{authFetch:e}=(0,a.a)(),t=(0,n.NL)();return(0,i.D)({mutationFn:async t=>e("/expenses/personal",{method:"POST",body:JSON.stringify(t)}),onSuccess:()=>{t.invalidateQueries({queryKey:["personal-expenses"]})}})},N=()=>{let{authFetch:e}=(0,a.a)();return(0,s.a)({queryKey:["personal-expenses"],queryFn:async()=>await e("/expenses/personal"),staleTime:15e3})},D=()=>{let{authFetch:e}=(0,a.a)(),t=(0,n.NL)();return(0,i.D)({mutationFn:async t=>(await e("/expenses/personal/".concat(t),{method:"DELETE"}),t),onSuccess:()=>{t.invalidateQueries({queryKey:["personal-expenses"]})}})}},3002:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var s=r(5893),n=r(6312),i=r(7536),a=r(3448),l=r(1163),o=r(2336),d=r(2417),u=r(1064),c=r(1027),m=r(8701),p=r(6471);let y=a.Ry({title:a.Z_().min(3,"Trip name is required"),description:a.Z_().optional(),destination:a.Z_().min(2,"Destination is required"),startDate:a.Z_(),endDate:a.Z_(),isPublic:a.O7().default(!1),tourType:a.Km(["friendly","paid"]).default("friendly"),showFinancialDetailsToMembers:a.O7().default(!0)});function x(){let e=(0,l.useRouter)(),t=(0,m.mm)(),{addGroup:r}=(0,p.q)(),{register:a,handleSubmit:x,reset:f,formState:{errors:g,isSubmitting:h}}=(0,i.cI)({resolver:(0,n.F)(y),defaultValues:{title:"",description:"",destination:"",startDate:new Date().toISOString().slice(0,10),endDate:new Date(Date.now()+864e5).toISOString().slice(0,10),isPublic:!1,tourType:"friendly",showFinancialDetailsToMembers:!0}}),b=x(async r=>{console.log("=== CREATE GROUP SUBMIT ==="),console.log("Input:",r);let s=await t.mutateAsync({title:r.title,description:r.description,destination:r.destination,startDate:new Date(r.startDate).toISOString(),endDate:new Date(r.endDate).toISOString(),isPublic:r.isPublic,tourType:r.tourType,showFinancialDetailsToMembers:r.showFinancialDetailsToMembers,members:[]});console.log("âœ… Group created:",s),console.log("Group ID:",s.id),console.log("Group ID type:",typeof s.id),f(),console.log("Navigating to:","/groups/".concat(s.id)),await e.push("/groups/".concat(s.id))});return(0,s.jsx)(o.L,{title:"Plan a new expedition",description:"Define your core itinerary, security posture, and travel brief before inviting members.",actions:(0,s.jsx)(c.C,{variant:"info",children:"Offline-ready templates"}),children:(0,s.jsxs)("form",{onSubmit:b,className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{children:"Trip overview"})}),(0,s.jsxs)(u.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"title",children:"Trip name"}),(0,s.jsx)("input",{id:"title",type:"text",...a("title"),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),g.title&&(0,s.jsx)("p",{className:"mt-1 text-xs text-red-600",children:g.title.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"description",children:"Mission brief"}),(0,s.jsx)("textarea",{id:"description",rows:4,...a("description"),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",placeholder:"Describe the goal, key stops, and any safety notes"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"destination",children:"Destination / hub"}),(0,s.jsx)("input",{id:"destination",type:"text",...a("destination"),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),g.destination&&(0,s.jsx)("p",{className:"mt-1 text-xs text-red-600",children:g.destination.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Visibility"}),(0,s.jsxs)("select",{...a("isPublic",{setValueAs:e=>"true"===e}),defaultValue:"false",className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,s.jsx)("option",{value:"false",children:"Private (invite only)"}),(0,s.jsx)("option",{value:"true",children:"Public (members request access)"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",children:"Tour type & financial privacy"}),(0,s.jsxs)("select",{...a("tourType",{onChange:e=>{let t=e.target.value,r=e.target.form;if(r){let e=r.querySelector('input[name="showFinancialDetailsToMembers"]');e&&(e.checked="friendly"===t)}}}),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,s.jsx)("option",{value:"friendly",children:"\uD83E\uDD1D Friendly tour (everyone sees all expenses)"}),(0,s.jsx)("option",{value:"paid",children:"\uD83D\uDCBC Paid tour (only admins see expenses)"})]}),(0,s.jsxs)("p",{className:"mt-1 text-xs text-slate-500",children:[(0,s.jsx)("strong",{children:"Friendly:"})," All members can see who paid what, all balances, and full expense details.",(0,s.jsx)("br",{}),(0,s.jsx)("strong",{children:"Paid:"})," Regular members cannot see ANY financial information. Only admins/co-admins can view expenses and balances."]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"startDate",children:"Start date"}),(0,s.jsx)("input",{id:"startDate",type:"date",...a("startDate"),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"endDate",children:"End date"}),(0,s.jsx)("input",{id:"endDate",type:"date",...a("endDate"),className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"})]})]})]})]}),(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{children:"Security & logistics"})}),(0,s.jsxs)(u.aY,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"Emergency protocols"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"Add emergency contacts, medical notes, and contingency plans after creating the trip."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"Offline readiness"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"Default travel pack includes offline maps, itinerary sync, and contact lists. Customize per destination inside the trip workspace."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-slate-700",children:"Invitations"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"Share the invite code below or generate QR codes inside the trip workspace. SMS invitations work offline and sync when online."})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(u.Zb,{children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{children:"Invite code & tags"})}),(0,s.jsx)(u.aY,{className:"space-y-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-slate-700",htmlFor:"tags",children:"Tags"}),(0,s.jsx)("input",{id:"tags",type:"text",placeholder:"Adventure, trekking, family",onBlur:e=>{let t=e.target.value.trim();if(!t)return;let r=t.split(/[,#]/).map(e=>e.trim()).filter(Boolean);e.target.value=r.join(", ")},className:"mt-1 w-full rounded-lg border border-slate-200 px-4 py-2 text-sm text-slate-700 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,s.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Use tags for quick filtering and guide recommendations."})]})})]}),(0,s.jsx)(u.Zb,{children:(0,s.jsxs)(u.aY,{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"After creating the group you can invite admins, add emergency protocols, upload travel docs, and configure offline data kits. Everything syncs automatically when you regain connectivity."}),(0,s.jsx)(d.z,{type:"submit",isLoading:h||t.isPending,loadingText:"Creating trip...",children:"Create trip workspace"})]})})]})]})})}}},function(e){e.O(0,[664,40,803,154,542,888,774,179],function(){return e(e.s=9442)}),_N_E=e.O()}]);