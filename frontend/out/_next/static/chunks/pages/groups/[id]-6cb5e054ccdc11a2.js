(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172,152],{6877:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/groups/[id]",function(){return t(7530)}])},6390:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});/**
 * @license lucide-react v0.435.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(1462).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},5451:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});/**
 * @license lucide-react v0.435.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,t(1462).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1027:function(e,s,t){"use strict";t.d(s,{C:function(){return l}});var n=t(5893),a=t(801);let r={default:"bg-slate-100 text-slate-700",success:"bg-emerald-100 text-emerald-700",warning:"bg-amber-100 text-amber-700",danger:"bg-red-100 text-red-700",info:"bg-blue-100 text-blue-700"};function l(e){let{className:s,variant:t="default",...l}=e;return(0,n.jsx)("span",{className:(0,a.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",r[t],s),...l})}},2417:function(e,s,t){"use strict";t.d(s,{z:function(){return o}});var n=t(5893),a=t(7294),r=t(801);let l={primary:"bg-primary-600 text-white hover:bg-primary-700",secondary:"border border-primary-600 text-primary-600 hover:bg-primary-50",subtle:"bg-slate-100 text-slate-700 hover:bg-slate-200",ghost:"text-slate-600 hover:bg-slate-100",danger:"bg-red-600 text-white hover:bg-red-700"},i={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-base"},o=a.forwardRef((e,s)=>{let{as:t="button",asChild:a,href:o,className:c,variant:d="primary",size:u="md",loadingText:m,isLoading:x,disabled:p,children:h,...g}=e,y=(0,r.cn)("inline-flex items-center justify-center rounded-md font-medium transition focus:outline-none focus:ring-2 focus:ring-primary-200 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60",l[d],i[u],c),{form:b,formAction:v,formEncType:f,formMethod:j,formNoValidate:N,formTarget:w,type:D,value:S,...C}=g;return"a"===t?(0,n.jsx)("a",{ref:s,href:o,className:y,"aria-disabled":p||x,...C,children:x?null!=m?m:"Loading...":h}):(0,n.jsx)("button",{ref:s,disabled:p||x,className:y,...g,children:x?null!=m?m:"Loading...":h})});o.displayName="Button"},8701:function(e,s,t){"use strict";t.d(s,{xH:function(){return y},Qc:function(){return v},mm:function(){return h},CB:function(){return N},Ui:function(){return D},i4:function(){return j},hA:function(){return f},xR:function(){return p},RW:function(){return x},Iw:function(){return g},D0:function(){return w},er:function(){return b}});var n=t(3934),a=t(202),r=t(8029),l=t(8111),i=t(6471);let o=e=>{var s,t,n,a;return{id:e.user.id,email:e.user.email,phone:e.user.phone,photoUrl:null!==(s=e.user.photoUrl)&&void 0!==s?s:null,bloodGroup:null!==(t=e.user.bloodGroup)&&void 0!==t?t:null,emergencyContact:null!==(n=e.user.emergencyContact)&&void 0!==n?n:null,createdAt:e.joinedAt,role:null,displayName:null!==(a=e.displayName)&&void 0!==a?a:e.user.email,status:e.status}},c=(e,s)=>{var t;return{id:String(s.id),groupId:e,title:s.title,description:null!==(t=s.description)&&void 0!==t?t:void 0,category:s.category,currency:s.currency,amount:s.amount,splits:s.splits.map(e=>({memberId:e.memberId,amount:e.amount})),paidBy:s.paidBy.id,incurredOn:s.incurredOn,receiptUrl:void 0,attachments:[],createdAt:s.createdAt}},d=e=>{var s,t;return{id:String(e.id),ownerType:e.ownerType,ownerId:e.ownerId,groupId:"group"===e.ownerType?String(e.ownerId):void 0,title:e.title,description:null!==(s=e.description)&&void 0!==s?s:void 0,fileType:e.fileType,fileSize:e.fileSize,storageKey:e.storageKey,expiresAt:null!==(t=e.expiresAt)&&void 0!==t?t:void 0,createdAt:e.createdAt,createdBy:e.createdBy.id,isEncrypted:e.isEncrypted}},u=e=>{var s,t;return{id:String(e.id),code:e.code,expiresAt:null!==(s=e.expiresAt)&&void 0!==s?s:void 0,usageLimit:null!==(t=e.usageLimit)&&void 0!==t?t:void 0,usedCount:e.usedCount,createdAt:e.createdAt,createdBy:e.createdBy.id}},m=e=>{var s,t,n,a,r,l,i;let m=String(e.id),x=e.members.map(o),p=e.expenses.map(e=>c(m,e)),h=e.documents.map(d);return{id:m,title:e.title,description:null!==(s=e.description)&&void 0!==s?s:void 0,destination:e.destination,startDate:e.startDate,endDate:e.endDate,isPublic:e.isPublic,inviteCode:e.inviteCode,coverImage:null!==(t=e.coverImage)&&void 0!==t?t:void 0,guides:null!==(n=e.guides)&&void 0!==n?n:[],tags:null!==(a=e.tags)&&void 0!==a?a:[],createdAt:e.createdAt,updatedAt:e.updatedAt,admins:e.members.filter(e=>"admin"===e.role||"co-admin"===e.role).map(e=>e.user.id),financeSummary:{totalExpenses:e.financeSummary.totalExpenses,totalMembers:e.financeSummary.totalMembers,outstandingBalance:e.financeSummary.outstandingBalance},offlinePackages:null!==(r=e.offlinePackages)&&void 0!==r?r:[],members:x,documents:h,itinerary:null!==(l=e.itinerary)&&void 0!==l?l:[],emergencyContacts:null!==(i=e.emergencyContacts)&&void 0!==i?i:[],invites:e.invites.map(u),expenses:p}},x=()=>{let{authFetch:e}=(0,l.a)(),s=(0,i.q)(e=>e.setGroups);return(0,n.a)({queryKey:["groups"],queryFn:async()=>{let t=(await e("/groups")).map(m);return s(t),t},staleTime:3e4})},p=e=>{let{authFetch:s}=(0,l.a)(),t=(0,i.q)(e=>e.setGroup);return(0,n.a)({queryKey:["groups",e],enabled:!!e,queryFn:async()=>{let n=m(await s("/groups/".concat(e)));return t(n),n},staleTime:3e4})},h=()=>{let{authFetch:e}=(0,l.a)(),s=(0,i.q)(e=>e.setGroup),t=(0,a.NL)();return(0,r.D)({mutationFn:async s=>m(await e("/groups",{method:"POST",body:JSON.stringify(s)})),onSuccess:e=>{s(e),t.invalidateQueries({queryKey:["groups"]}),t.invalidateQueries({queryKey:["groups",e.id]})}})},g=e=>{let{authFetch:s}=(0,l.a)(),t=(0,a.NL)();return(0,r.D)({mutationFn:async t=>await s("/groups/".concat(e,"/invite"),{method:"POST",body:JSON.stringify(t)}),onSuccess:()=>{t.invalidateQueries({queryKey:["groups",e]}),t.invalidateQueries({queryKey:["groups"]})}})},y=e=>{let{authFetch:s}=(0,l.a)(),t=(0,a.NL)();return(0,r.D)({mutationFn:async t=>await s("/groups/".concat(e,"/members"),{method:"POST",body:JSON.stringify(t)}),onSuccess:()=>{t.invalidateQueries({queryKey:["groups",e]}),t.invalidateQueries({queryKey:["groups"]})}})},b=e=>{let{authFetch:s}=(0,l.a)(),t=(0,a.NL)();return(0,r.D)({mutationFn:async t=>(await s("/groups/".concat(e,"/members/").concat(t),{method:"DELETE"}),t),onSuccess:()=>{t.invalidateQueries({queryKey:["groups",e]}),t.invalidateQueries({queryKey:["groups"]})}})},v=e=>{let{authFetch:s}=(0,l.a)(),t=(0,a.NL)();return(0,r.D)({mutationFn:async t=>{if(!e)throw Error("Group id is required to create an expense");return s("/groups/".concat(e,"/expenses"),{method:"POST",body:JSON.stringify(t)})},onSuccess:(s,n,a)=>(e&&(t.invalidateQueries({queryKey:["groups",e]}),t.invalidateQueries({queryKey:["groups",e,"expenses"]}),t.invalidateQueries({queryKey:["groups",e,"balance"]}),t.invalidateQueries({queryKey:["groups"]})),a)})},f=e=>{let{authFetch:s}=(0,l.a)();return(0,n.a)({queryKey:["groups",e,"expenses"],enabled:!!e,queryFn:async()=>e?(await s("/groups/".concat(e,"/expenses"))).map(s=>c(e,s)):[],staleTime:15e3})},j=e=>{let{authFetch:s}=(0,l.a)();return(0,n.a)({queryKey:["groups",e,"balance"],enabled:!!e,queryFn:async()=>e?await s("/groups/".concat(e,"/balance")):null,staleTime:15e3})},N=()=>{let{authFetch:e}=(0,l.a)(),s=(0,a.NL)();return(0,r.D)({mutationFn:async s=>e("/expenses/personal",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{s.invalidateQueries({queryKey:["personal-expenses"]})}})},w=()=>{let{authFetch:e}=(0,l.a)();return(0,n.a)({queryKey:["personal-expenses"],queryFn:async()=>await e("/expenses/personal"),staleTime:15e3})},D=()=>{let{authFetch:e}=(0,l.a)(),s=(0,a.NL)();return(0,r.D)({mutationFn:async s=>(await e("/expenses/personal/".concat(s),{method:"DELETE"}),s),onSuccess:()=>{s.invalidateQueries({queryKey:["personal-expenses"]})}})}},554:function(e,s,t){"use strict";t.d(s,{c:function(){return r}});var n=t(7294),a=t(3911);function r(e){let[s,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!1),i=(0,n.useCallback)(s=>{let n=a.j.getDeviceInfo(),r={id:"msg-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),from:n.id,fromName:n.name,text:s,timestamp:Date.now(),groupId:e};t(e=>[...e,r]),a.j.broadcast({type:"chat",data:r}),console.log("[MeshChat] Sent message:",s)},[e]);return(0,n.useEffect)(()=>a.j.onMessage(s=>{if("chat"===s.type){let n=s.data;if(e&&n.groupId!==e)return;let r=a.j.getDeviceInfo();n.from!==r.id&&(console.log("[MeshChat] Received message:",n),t(e=>e.some(e=>e.id===n.id)?e:[...e,n]))}}),[e]),(0,n.useEffect)(()=>{let e=()=>{l(a.j.getConnectedPeers().length>0)},s=a.j.onPeerConnected(e),t=a.j.onPeerDisconnected(e);return e(),()=>{s(),t()}},[]),{messages:s,sendMessage:i,clearMessages:(0,n.useCallback)(()=>{t([])},[]),isConnected:r,deviceInfo:a.j.getDeviceInfo()}}},646:function(e,s,t){"use strict";t.d(s,{k:function(){return l}});var n=t(7294),a=t(3911),r=t(2003);function l(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],[t,l]=(0,n.useState)(!1),[i,o]=(0,n.useState)([]),[c,d]=(0,n.useState)({connectedPeers:0,expensesSynced:0,messagesReceived:0,lastSync:null}),u=(0,n.useCallback)(()=>{let e=a.j.getConnectedPeers();o(e),d(s=>({...s,connectedPeers:e.length}))},[]),m=(0,n.useCallback)(async()=>{if(!a.j.isBluetoothSupported()){alert("Bluetooth is not supported in your browser. Try Chrome on Android or desktop.");return}l(!0);try{await a.j.startDiscovery(),u()}catch(e){console.error("[MeshSync] Discovery failed:",e),alert("Discovery failed: ".concat(e.message))}finally{l(!1)}},[u]),x=(0,n.useCallback)(async s=>{e&&(console.log("[MeshSync] Broadcasting expense:",s),a.j.broadcast({type:"expense",data:{action:"create",groupId:e,expense:s}}),d(e=>({...e,expensesSynced:e.expensesSynced+1,lastSync:new Date().toISOString()})))},[e]),p=(0,n.useCallback)(async()=>{e&&(console.log("[MeshSync] Requesting sync from peers..."),a.j.broadcast({type:"sync",data:{action:"request",groupId:e,deviceId:a.j.getDeviceInfo().id}}))},[e]);return(0,n.useEffect)(()=>{if(s&&e)return a.j.onMessage(async s=>{if(console.log("[MeshSync] Received message:",s),d(e=>({...e,messagesReceived:e.messagesReceived+1})),"expense"===s.type){let{action:t,expense:n}=s.data;"create"===t&&n.groupId===e&&(console.log("[MeshSync] Syncing expense from peer:",n),await r.N.put(r.R.expenses,{...n,_syncedFromMesh:!0,_meshSource:s.from,_meshTimestamp:s.timestamp}),await r.N.addToSyncQueue({type:"CREATE_EXPENSE",method:"POST",url:"/groups/".concat(e,"/expenses"),body:n}),d(e=>({...e,expensesSynced:e.expensesSynced+1,lastSync:new Date().toISOString()})))}else if("sync"===s.type){let{action:t}=s.data;if("request"===t&&s.data.groupId===e){console.log("[MeshSync] Peer requested sync, sending expenses...");let s=await r.N.getByIndex(r.R.expenses,"groupId",e);if(Array.isArray(s))for(let t of s)a.j.broadcast({type:"expense",data:{action:"create",groupId:e,expense:t}})}}})},[s,e]),(0,n.useEffect)(()=>{let s=a.j.onPeerConnected(()=>{u(),e&&p()}),t=a.j.onPeerDisconnected(()=>{u()});return()=>{s(),t()}},[u,p,e]),(0,n.useEffect)(()=>{u()},[u]),{isDiscovering:t,connectedPeers:i,stats:c,startDiscovery:m,syncExpenseToMesh:x,requestSyncFromPeers:p,deviceInfo:a.j.getDeviceInfo()}}},3911:function(e,s,t){"use strict";t.d(s,{j:function(){return a}});class n{generateDeviceId(){let e=localStorage.getItem("mesh_device_id");if(e)return e;let s="device-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));return localStorage.setItem("mesh_device_id",s),s}getDeviceName(){let e=localStorage.getItem("mesh_device_name");if(e)return e;let s="Traveler-".concat(Math.random().toString(36).substr(2,4).toUpperCase());return localStorage.setItem("mesh_device_name",s),s}isBluetoothSupported(){return"bluetooth"in navigator}async startDiscovery(){if(console.log("[Mesh] Starting discovery..."),!this.isBluetoothSupported())throw console.warn("[Mesh] Bluetooth not supported in this browser"),Error("Bluetooth not supported");try{let e=await navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["battery_service","device_information"]});console.log("[Mesh] Found device:",e.name);let s={id:e.id,name:e.name||"Unknown Device",device:e,lastSeen:Date.now(),status:"connecting"};this.peers.set(s.id,s),await this.connectToPeer(s)}catch(e){throw console.error("[Mesh] Discovery error:",e),e}}async connectToPeer(e){console.log("[Mesh] Connecting to peer:",e.name);try{let s=new RTCPeerConnection({iceServers:[]});e.connection=s;let t=s.createDataChannel("mesh-sync",{ordered:!0});e.channel=t,t.onopen=()=>{console.log("[Mesh] Data channel opened with",e.name),e.status="connected",e.lastSeen=Date.now(),this.onPeerConnectedCallbacks.forEach(s=>s(e)),this.sendToPeer(e.id,{type:"ping",from:this.deviceId,timestamp:Date.now(),data:{deviceId:this.deviceId,deviceName:this.deviceName}})},t.onmessage=s=>{try{let t=JSON.parse(s.data);console.log("[Mesh] Received message:",t),e.lastSeen=Date.now(),this.handleMessage(t,e)}catch(e){console.error("[Mesh] Error parsing message:",e)}},t.onclose=()=>{console.log("[Mesh] Data channel closed with",e.name),e.status="disconnected",this.onPeerDisconnectedCallbacks.forEach(s=>s(e.id))},t.onerror=e=>{console.error("[Mesh] Data channel error:",e)};let n=await s.createOffer();await s.setLocalDescription(n),console.log("[Mesh] WebRTC connection established with",e.name)}catch(s){console.error("[Mesh] Connection error:",s),e.status="disconnected"}}sendToPeer(e,s){let t=this.peers.get(e);if(!t||"connected"!==t.status||!t.channel){console.warn("[Mesh] Cannot send to peer:",e);return}try{t.channel.send(JSON.stringify(s)),console.log("[Mesh] Sent message to",t.name)}catch(e){console.error("[Mesh] Send error:",e)}}broadcast(e){let s={...e,from:this.deviceId,timestamp:Date.now()};console.log("[Mesh] Broadcasting:",s),this.peers.forEach((e,t)=>{"connected"===e.status&&this.sendToPeer(t,s)})}handleMessage(e,s){if(console.log("[Mesh] Handling message type:",e.type),s.lastSeen=Date.now(),e.to&&e.to!==this.deviceId){let s=this.peers.get(e.to);s&&"connected"===s.status&&(this.sendToPeer(e.to,e),console.log("[Mesh] Relayed message to",s.name))}this.onMessageCallbacks.forEach(s=>s(e))}onMessage(e){return this.onMessageCallbacks.push(e),()=>{let s=this.onMessageCallbacks.indexOf(e);s>-1&&this.onMessageCallbacks.splice(s,1)}}onPeerConnected(e){return this.onPeerConnectedCallbacks.push(e),()=>{let s=this.onPeerConnectedCallbacks.indexOf(e);s>-1&&this.onPeerConnectedCallbacks.splice(s,1)}}onPeerDisconnected(e){return this.onPeerDisconnectedCallbacks.push(e),()=>{let s=this.onPeerDisconnectedCallbacks.indexOf(e);s>-1&&this.onPeerDisconnectedCallbacks.splice(s,1)}}getConnectedPeers(){return Array.from(this.peers.values()).filter(e=>"connected"===e.status)}getDeviceInfo(){return{id:this.deviceId,name:this.deviceName}}disconnect(){console.log("[Mesh] Disconnecting from all peers..."),this.peers.forEach(e=>{e.channel&&e.channel.close(),e.connection&&e.connection.close(),e.status="disconnected"}),this.peers.clear()}healthCheck(){let e=Date.now();this.peers.forEach((s,t)=>{e-s.lastSeen>3e4&&(console.log("[Mesh] Peer timeout:",s.name),s.channel&&s.channel.close(),s.connection&&s.connection.close(),s.status="disconnected",this.onPeerDisconnectedCallbacks.forEach(e=>e(t)))})}constructor(){this.peers=new Map,this.onMessageCallbacks=[],this.onPeerConnectedCallbacks=[],this.onPeerDisconnectedCallbacks=[],this.deviceId=this.generateDeviceId(),this.deviceName=this.getDeviceName()}}let a=new n;setInterval(()=>a.healthCheck(),1e4)},7530:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return E}});var n=t(5893),a=t(7294),r=t(1163),l=t(7168),i=t(1664),o=t.n(i),c=t(2336),d=t(1064),u=t(2417),m=t(1027),x=t(801);let p=e=>{let{defaultValue:s,value:t,onValueChange:r,children:l,className:i}=e,[o,c]=a.useState(t||s||"");return a.useEffect(()=>{void 0!==t&&c(t)},[t]),(0,n.jsx)("div",{className:(0,x.cn)("w-full",i),children:(0,n.jsx)(h.Provider,{value:{activeTab:o,setActiveTab:e=>{void 0===t&&c(e),null==r||r(e)}},children:l})})},h=a.createContext({activeTab:"",setActiveTab:()=>{}}),g=e=>{let{children:s,className:t}=e;return(0,n.jsx)("div",{className:(0,x.cn)("flex items-center gap-1 border-b border-slate-200",t),children:s})},y=e=>{let{value:s,children:t,className:r}=e,{activeTab:l,setActiveTab:i}=a.useContext(h),o=l===s;return(0,n.jsx)("button",{type:"button",onClick:()=>i(s),className:(0,x.cn)("px-4 py-2 text-sm font-medium transition-colors",o?"border-b-2 border-primary-600 text-primary-600":"text-slate-600 hover:text-slate-900",r),children:t})},b=e=>{let{value:s,children:t,className:r}=e,{activeTab:l}=a.useContext(h);return l!==s?null:(0,n.jsx)("div",{className:(0,x.cn)("mt-4",r),children:t})};var v=t(6390),f=t(5451),j=t(8701),N=t(554),w=t(646),D=t(3313),S=t(8176);/**
 * @license lucide-react v0.435.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let C=(0,t(1462).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function P(e){let{groupId:s,groupName:t}=e,[r,l]=(0,a.useState)(""),i=(0,a.useRef)(null),[o,c]=(0,a.useState)(!0),{messages:d,sendMessage:u,deviceInfo:m}=(0,N.c)(s),{connectedPeers:x,startDiscovery:p,isDiscovering:h}=(0,w.k)(s,!0);(0,a.useEffect)(()=>{c(navigator.onLine);let e=()=>c(!0),s=()=>c(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]),(0,a.useEffect)(()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[d]);let g=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg shadow-lg",children:[(0,n.jsx)("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-t-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h3",{className:"font-bold text-lg",children:["\uD83D\uDCAC ",t||"Group Chat"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs opacity-90",children:[o?(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(D.Z,{className:"w-3 h-3"})," Online"]}):(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)(S.Z,{className:"w-3 h-3"})," Offline (Mesh)"]}),(0,n.jsx)("span",{children:"•"}),(0,n.jsxs)("span",{children:[x.length," peers connected"]})]})]}),!o&&0===x.length&&(0,n.jsx)("button",{onClick:p,disabled:h,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium disabled:opacity-50 transition",children:h?"⏳ Finding...":"\uD83D\uDCE1 Connect"})]})}),!o&&0===x.length&&(0,n.jsx)("div",{className:"px-4 py-2 bg-amber-50 dark:bg-amber-900/20 border-b border-amber-200 dark:border-amber-800",children:(0,n.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:'⚠️ Offline mode. Click "Connect" to find nearby group members via Bluetooth mesh.'})}),!o&&x.length>0&&(0,n.jsx)("div",{className:"px-4 py-2 bg-green-50 dark:bg-green-900/20 border-b border-green-200 dark:border-green-800",children:(0,n.jsxs)("p",{className:"text-xs text-green-700 dark:text-green-300",children:["✓ Connected to ",x.length," peer",1!==x.length?"s":""," via mesh network"]})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-[400px] max-h-[600px]",children:[0===d.length?(0,n.jsxs)("div",{className:"text-center text-gray-400 py-8",children:[(0,n.jsx)("p",{className:"text-2xl mb-2",children:"\uD83D\uDCAC"}),(0,n.jsx)("p",{className:"text-sm",children:"No messages yet"}),(0,n.jsx)("p",{className:"text-xs mt-1",children:"Start the conversation!"})]}):d.map(e=>{let s=e.from===m.id;return(0,n.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-[70%] rounded-lg px-3 py-2 ".concat(s?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white"),children:[!s&&(0,n.jsx)("p",{className:"text-xs font-semibold mb-1 opacity-75",children:e.fromName}),(0,n.jsx)("p",{className:"text-sm break-words",children:e.text}),(0,n.jsx)("p",{className:"text-xs mt-1 ".concat(s?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:g(e.timestamp)})]})},e.id)}),(0,n.jsx)("div",{ref:i})]}),(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&(u(r),l(""))},className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 rounded-b-lg",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{type:"text",value:r,onChange:e=>l(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),(0,n.jsxs)("button",{type:"submit",disabled:!r.trim(),className:"px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium disabled:opacity-50 disabled:hover:bg-blue-500 transition flex items-center gap-2",children:[(0,n.jsx)(C,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"Send"})]})]}),(0,n.jsx)("div",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:o?(0,n.jsx)("span",{children:"\uD83D\uDFE2 Messages sent via internet"}):x.length>0?(0,n.jsxs)("span",{children:["\uD83D\uDD17 Messages sent via Bluetooth mesh (",x.length," peer",1!==x.length?"s":"",")"]}):(0,n.jsx)("span",{children:"⚠️ Offline - connect to peers to send messages"})})]})]})}var k=t(8111);function E(){var e,s,t;let i=(0,r.useRouter)(),x=i.query.id,{user:h}=(0,k.a)();console.log("=== GROUP DETAIL PAGE RENDER ==="),console.log("Router query:",i.query),console.log("Group ID:",x),console.log("Router pathname:",i.pathname),console.log("Router asPath:",i.asPath);let{data:N,isLoading:w,refetch:D}=(0,j.xR)(x),{data:S}=(0,j.hA)(x),{data:C}=(0,j.i4)(x),E=(0,j.Qc)(x),I=(0,j.Iw)(x),M=(0,j.xH)(x),A=(0,j.er)(x),{data:O=[]}=(0,j.D0)(),T=(0,j.CB)(),B=(0,j.Ui)(),q=(0,a.useMemo)(()=>N&&h?N.members.find(e=>e.id===h.id):null,[N,h]),F=(0,a.useMemo)(()=>{var e;return!!q&&!!h&&((null==N?void 0:null===(e=N.admins)||void 0===e?void 0:e.includes(h.id))||!1)},[q,h,N]);(0,a.useMemo)(()=>{var e;return!!q&&(F||(null===(e=q.role)||void 0===e?void 0:e.name)==="co-admin")},[q,F]);let[R,U]=(0,a.useState)("overview"),[L,Z]=(0,a.useState)("group"),[G,_]=(0,a.useState)(!1),[z,K]=(0,a.useState)(""),[Y,Q]=(0,a.useState)({email:"",phone:"",role:"member",displayName:"",password:""}),[W,J]=(0,a.useState)({title:"",amount:"",category:"food",currency:"USD",paidById:""}),[$,V]=(0,a.useState)({title:"",amount:"",category:"food",currency:"USD"});if(w)return(0,n.jsx)(c.L,{title:"Loading...",description:"Please wait",actions:null,children:(0,n.jsx)(d.Zb,{children:(0,n.jsx)(d.aY,{children:(0,n.jsx)("p",{className:"text-sm text-slate-600",children:"Loading group details..."})})})});if(!N)return(0,n.jsx)(c.L,{title:"Not Found",description:"Group not found",actions:null,children:(0,n.jsx)(d.Zb,{children:(0,n.jsxs)(d.aY,{children:[(0,n.jsx)("p",{className:"text-sm text-slate-600",children:"Group not found. It may have been deleted or you may not have access."}),(0,n.jsx)(u.z,{variant:"secondary",className:"mt-4",asChild:!0,children:(0,n.jsx)(o(),{href:"/groups",children:"Back to Groups"})})]})})});let H=async e=>{if(e.preventDefault(),z)try{await I.mutateAsync({email:z,role:"member"}),K(""),alert("Invitation sent successfully!")}catch(e){alert("Failed to invite member: "+((null==e?void 0:e.message)||"Unknown error"))}},X=async e=>{if(e.preventDefault(),!Y.email&&!Y.phone){alert("Please provide either email or phone number");return}console.log("=== ADD MEMBER DEBUG ==="),console.log("Group ID:",x),console.log("Current group data:",N),console.log("Payload:",{email:Y.email||void 0,phone:Y.phone||void 0,role:Y.role,displayName:Y.displayName||void 0});try{let e=await M.mutateAsync({email:Y.email||void 0,phone:Y.phone||void 0,role:Y.role,displayName:Y.displayName||void 0,password:Y.password||void 0});console.log("✅ Mutation SUCCESS:",e),console.log("Group ID after mutation:",x),Q({email:"",phone:"",role:"member",displayName:"",password:""}),_(!1),console.log("Starting refetch..."),await D(),console.log("✅ Refetch complete"),alert("Member added successfully!")}catch(s){console.error("❌ ADD MEMBER ERROR ===",s),console.error("Error status:",null==s?void 0:s.status),console.error("Error message:",null==s?void 0:s.message),console.error("Full error:",JSON.stringify(s,null,2));let e=(null==s?void 0:s.message)||(null==s?void 0:s.statusText)||"Unknown error";alert("Failed to add member: ".concat(e,"\n\nCheck console for details (F12)"));return}},ee=async e=>{if(e.preventDefault(),!W.title||!W.amount||!W.paidById){alert("Please fill in all required fields");return}let s=parseInt(W.paidById);try{let e=parseFloat(W.amount),t=N.members.length,n=Math.floor(e/t*100)/100,a=N.members.map((s,a)=>{let r=a===t-1?Number((e-n*(t-1)).toFixed(2)):Number(n);return{memberId:Number(s.id),amount:r}}),r=a.reduce((e,s)=>e+s.amount,0);console.log("Expense details:",{amount:e,splits:a,total:r,difference:Math.abs(r-e)}),await E.mutateAsync({title:W.title,category:W.category,currency:W.currency,amount:Number(e),paidById:Number(s),incurredOn:new Date().toISOString(),splits:a}),J({title:"",amount:"",category:"food",currency:"USD",paidById:""}),alert("Expense added successfully!")}catch(e){console.error("Expense creation error:",e),alert("Failed to add expense: "+((null==e?void 0:e.message)||"Unknown error"))}},es=async e=>{if(e.preventDefault(),!$.title||!$.amount){alert("Please fill in all required fields");return}try{await T.mutateAsync({title:$.title,category:$.category,currency:$.currency,amount:Number($.amount),incurredOn:new Date().toISOString()}),V({title:"",amount:"",category:"food",currency:"USD"}),alert("Personal expense added successfully!")}catch(e){alert("Failed to add personal expense: "+((null==e?void 0:e.message)||"Unknown error"))}},et=async e=>{if(confirm("Are you sure you want to delete this expense?"))try{await B.mutateAsync(e),alert("Personal expense deleted successfully!")}catch(e){alert("Failed to delete expense: "+((null==e?void 0:e.message)||"Unknown error"))}};return(0,n.jsxs)(c.L,{title:N.title,description:N.destination,actions:(0,n.jsxs)(n.Fragment,{children:[q&&(0,n.jsxs)(m.C,{variant:"info",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[F&&"\uD83D\uDC51 Admin",!F&&(null===(e=q.role)||void 0===e?void 0:e.name)==="co-admin"&&"⭐ Co-Admin",!F&&(null===(s=q.role)||void 0===s?void 0:s.name)!=="co-admin"&&"\uD83D\uDC64 Member"]}),F&&(0,n.jsx)(u.z,{variant:"secondary",asChild:!0,children:(0,n.jsx)(o(),{href:"/groups/".concat(x,"/edit"),children:"Edit Group"})}),(0,n.jsx)(u.z,{variant:"ghost",asChild:!0,children:(0,n.jsx)(o(),{href:"/groups",children:"Back"})})]}),children:[(0,n.jsx)(d.Zb,{className:"mb-6",children:(0,n.jsxs)(d.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:N.title}),(0,n.jsx)("p",{className:"text-slate-600",children:N.destination})]}),(0,n.jsx)(m.C,{variant:N.isPublic?"info":"default",children:N.isPublic?"Public":"Private"})]}),N.description&&(0,n.jsx)("p",{className:"text-sm text-slate-700",children:N.description}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm md:grid-cols-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-500",children:"Start Date"}),(0,n.jsx)("p",{className:"font-medium text-slate-900",children:(0,l.WU)(new Date(N.startDate),"PPP")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-500",children:"End Date"}),(0,n.jsx)("p",{className:"font-medium text-slate-900",children:(0,l.WU)(new Date(N.endDate),"PPP")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-500",children:"Invite Code"}),(0,n.jsx)("p",{className:"font-mono font-medium text-primary-600",children:N.inviteCode})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-500",children:"Total Spent"}),(0,n.jsxs)("p",{className:"font-medium text-slate-900",children:["$",N.financeSummary.totalExpenses.toLocaleString()]})]})]})]})}),(0,n.jsxs)(p,{value:R,onValueChange:U,children:[(0,n.jsxs)(g,{children:[(0,n.jsx)(y,{value:"overview",children:"Overview"}),(0,n.jsx)(y,{value:"chat",children:"\uD83D\uDCAC Chat"}),(0,n.jsxs)(y,{value:"members",children:["Members (",N.members.length,")"]}),(0,n.jsxs)(y,{value:"expenses",children:["Expenses (",(null==S?void 0:S.length)||0,")"]}),(0,n.jsxs)(y,{value:"documents",children:["Documents (",N.documents.length,")"]}),(0,n.jsxs)(y,{value:"itinerary",children:["Itinerary (",N.itinerary.length,")"]})]}),(0,n.jsx)(b,{value:"overview",children:(0,n.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[F?(0,n.jsxs)(d.Zb,{className:"border-white/50 bg-white/80 backdrop-blur-sm shadow-xl",children:[(0,n.jsx)(d.Ol,{children:(0,n.jsxs)(d.ll,{className:"flex items-center gap-2",children:["\uD83D\uDCB0 Financial Summary",(0,n.jsx)(m.C,{variant:"info",className:"bg-gradient-to-r from-purple-500 to-pink-600 text-white text-xs",children:"Admin View"})]})}),(0,n.jsxs)(d.aY,{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Total Expenses"}),(0,n.jsxs)("span",{className:"font-semibold",children:["$",N.financeSummary.totalExpenses.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Outstanding Balance"}),(0,n.jsxs)("span",{className:"font-semibold",children:["$",N.financeSummary.outstandingBalance.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Per Person Average"}),(0,n.jsxs)("span",{className:"font-semibold",children:["$",N.members.length>0?(N.financeSummary.totalExpenses/N.members.length).toFixed(2):"0.00"]})]})]})]}):(0,n.jsxs)(d.Zb,{className:"border-white/50 bg-white/80 backdrop-blur-sm shadow-xl",children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"\uD83D\uDCB0 Financial Summary"})}),(0,n.jsx)(d.aY,{children:(0,n.jsxs)("div",{className:"text-center py-8 bg-amber-50 rounded-xl border border-amber-200",children:[(0,n.jsx)(v.Z,{className:"w-12 h-12 mx-auto text-amber-600 mb-3"}),(0,n.jsx)("p",{className:"text-sm text-amber-700 mb-2 font-medium",children:"Financial details are private"}),(0,n.jsx)("p",{className:"text-xs text-amber-600",children:"Only the group admin can view detailed financial information."})]})})]}),(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Quick Stats"})}),(0,n.jsxs)(d.aY,{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Members"}),(0,n.jsx)("span",{className:"font-semibold",children:N.members.length})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Documents"}),(0,n.jsx)("span",{className:"font-semibold",children:N.documents.length})]}),(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsx)("span",{className:"text-slate-600",children:"Itinerary Items"}),(0,n.jsx)("span",{className:"font-semibold",children:N.itinerary.length})]})]})]})]})}),(0,n.jsx)(b,{value:"chat",children:(0,n.jsx)(d.Zb,{className:"h-[700px]",children:(0,n.jsx)(d.aY,{className:"p-0 h-full",children:(0,n.jsx)(P,{groupId:x,groupName:N.title})})})}),(0,n.jsx)(b,{value:"members",children:(0,n.jsxs)("div",{className:"space-y-6",children:[!F&&(0,n.jsx)(d.Zb,{className:"border-blue-200 bg-blue-50",children:(0,n.jsx)(d.aY,{className:"py-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(v.Z,{className:"w-5 h-5 text-blue-600"}),(0,n.jsxs)("p",{className:"text-sm text-blue-800",children:["You are viewing as a ",(0,n.jsx)("strong",{children:(null==q?void 0:null===(t=q.role)||void 0===t?void 0:t.name)||"member"}),". Only the group admin can add or remove members."]})]})})}),F&&(0,n.jsxs)(d.Zb,{children:[(0,n.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between",children:[(0,n.jsxs)(d.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(v.Z,{className:"w-5 h-5 text-blue-600"}),"Add Member (Admin Only)"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(u.z,{variant:G?"subtle":"secondary",size:"sm",onClick:()=>_(!1),children:"By Email Invite"}),(0,n.jsx)(u.z,{variant:G?"secondary":"subtle",size:"sm",onClick:()=>_(!0),children:"Direct Add"})]})]}),(0,n.jsx)(d.aY,{children:G?(0,n.jsxs)("form",{onSubmit:X,className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-sm text-slate-600",children:"Add a member directly (creates account if they dont exist)"}),(0,n.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,n.jsx)("input",{type:"email",value:Y.email,onChange:e=>Q({...Y,email:e.target.value}),placeholder:"Email (required if no phone)",className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)("input",{type:"tel",value:Y.phone,onChange:e=>Q({...Y,phone:e.target.value}),placeholder:"Phone (required if no email)",className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)("input",{type:"text",value:Y.displayName,onChange:e=>Q({...Y,displayName:e.target.value}),placeholder:"Display Name (optional)",className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)("input",{type:"password",value:Y.password,onChange:e=>Q({...Y,password:e.target.value}),placeholder:"Password (optional, auto-generated)",className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsxs)("select",{value:Y.role,onChange:e=>Q({...Y,role:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,n.jsx)("option",{value:"member",children:"Member"}),(0,n.jsx)("option",{value:"co-admin",children:"Co-Admin"}),(0,n.jsx)("option",{value:"admin",children:"Admin"})]})]}),(0,n.jsx)(u.z,{type:"submit",isLoading:M.isPending,children:"Add Member"})]}):(0,n.jsxs)("form",{onSubmit:H,className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-sm text-slate-600",children:"Send an invitation link to join this group"}),(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("input",{type:"email",value:z,onChange:e=>K(e.target.value),placeholder:"Enter email address",className:"flex-1 rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)(u.z,{type:"submit",isLoading:I.isPending,children:"Send Invite"})]})]})})]}),(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Current Members"})}),(0,n.jsx)(d.aY,{children:(0,n.jsx)("div",{className:"space-y-3",children:0===N.members.length?(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No members yet. Invite someone to get started!"}):N.members.map(e=>{var s,t;let a=null===(s=N.admins)||void 0===s?void 0:s.includes(e.id);return(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 pb-3 last:border-0",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"font-medium text-slate-900",children:e.displayName||e.email}),a&&(0,n.jsx)(m.C,{variant:"info",className:"bg-gradient-to-r from-purple-500 to-pink-600 text-white",children:"\uD83D\uDC51 Admin"}),!a&&(null===(t=e.role)||void 0===t?void 0:t.name)==="co-admin"&&(0,n.jsx)(m.C,{variant:"info",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:"⭐ Co-Admin"})]}),(0,n.jsx)("p",{className:"text-xs text-slate-500",children:e.email}),e.emergencyContact&&(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:["Emergency: ",e.emergencyContact]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(m.C,{variant:"active"===e.status?"success":"default",children:e.status||"active"}),F&&e.id!==(null==h?void 0:h.id)&&(0,n.jsx)(u.z,{variant:"danger",size:"sm",onClick:()=>A.mutate(e.id),isLoading:A.isPending,children:"Remove"})]})]},e.id)})})})]})]})}),(0,n.jsx)(b,{value:"expenses",children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(d.Zb,{children:(0,n.jsx)(d.aY,{className:"pt-6",children:(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsxs)(u.z,{variant:"group"===L?"primary":"secondary",onClick:()=>Z("group"),className:"flex-1",children:["Group Expenses (",(null==S?void 0:S.length)||0,")"]}),(0,n.jsxs)(u.z,{variant:"personal"===L?"primary":"secondary",onClick:()=>Z("personal"),className:"flex-1",children:["Personal Expenses (",(null==O?void 0:O.length)||0,")"]})]})})}),"group"===L?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Add New Group Expense"})}),(0,n.jsx)(d.aY,{children:(0,n.jsxs)("form",{onSubmit:ee,className:"space-y-3",children:[(0,n.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,n.jsx)("input",{type:"text",value:W.title,onChange:e=>J({...W,title:e.target.value}),placeholder:"Expense title",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:W.amount,onChange:e=>J({...W,amount:e.target.value}),placeholder:"Amount",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsxs)("select",{value:W.category,onChange:e=>J({...W,category:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,n.jsx)("option",{value:"food",children:"Food"}),(0,n.jsx)("option",{value:"accommodation",children:"Accommodation"}),(0,n.jsx)("option",{value:"transport",children:"Transport"}),(0,n.jsx)("option",{value:"activities",children:"Activities"}),(0,n.jsx)("option",{value:"gear",children:"Gear"}),(0,n.jsx)("option",{value:"other",children:"Other"})]}),(0,n.jsxs)("select",{value:W.paidById,onChange:e=>J({...W,paidById:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",required:!0,children:[(0,n.jsx)("option",{value:"",children:"Who paid?"}),N.members.map(e=>(0,n.jsx)("option",{value:e.id,children:e.displayName||e.email},e.id))]}),(0,n.jsxs)("select",{value:W.currency,onChange:e=>J({...W,currency:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,n.jsx)("option",{value:"USD",children:"USD"}),(0,n.jsx)("option",{value:"EUR",children:"EUR"}),(0,n.jsx)("option",{value:"GBP",children:"GBP"}),(0,n.jsx)("option",{value:"INR",children:"INR"}),(0,n.jsx)("option",{value:"BDT",children:"BDT"})]})]}),(0,n.jsx)(u.z,{type:"submit",isLoading:E.isPending,children:"Add Expense"})]})})]}),(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Recent Expenses"})}),(0,n.jsx)(d.aY,{children:(0,n.jsx)("div",{className:"space-y-3",children:S&&0!==S.length?S.map(e=>{let s=N.members.find(s=>s.id===e.paidBy),t=(null==s?void 0:s.displayName)||(null==s?void 0:s.email)||"Unknown";return(0,n.jsx)("div",{className:"border-b border-slate-100 pb-3 last:border-0",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)("p",{className:"font-medium text-slate-900",children:e.title})}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:[e.category," \xb7 ",(0,l.WU)(new Date(e.incurredOn),"PPP")]}),(0,n.jsxs)("p",{className:"text-xs text-slate-600 mt-1",children:["Paid by: ",(0,n.jsx)("span",{className:"font-medium",children:t})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("p",{className:"font-semibold text-slate-900",children:[e.currency," ",e.amount.toFixed(2)]}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:["Split: ",e.currency," ",(e.amount/e.splits.length).toFixed(2)," each"]})]})]})},e.id)}):(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No expenses recorded yet."})})})]}),C&&C.members&&C.members.length>0&&(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Who Paid & Who Owes"})}),(0,n.jsx)(d.aY,{children:(0,n.jsxs)("div",{className:"space-y-3",children:[C.members.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-slate-50 transition",children:[(0,n.jsx)("p",{className:"font-semibold text-slate-900 mb-3",children:e.displayName||"Member #".concat(e.memberId)}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"I Paid"}),(0,n.jsxs)("p",{className:"text-lg font-bold text-blue-900",children:["$",e.paid.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"bg-slate-100 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"My Share"}),(0,n.jsxs)("p",{className:"text-lg font-bold text-slate-900",children:["$",e.owed.toFixed(2)]})]})]}),(0,n.jsxs)("div",{className:"rounded-lg p-3 ".concat(e.balance>=0?"bg-green-50":"bg-red-50"),children:[(0,n.jsx)("p",{className:"text-xs font-medium mb-1 ".concat(e.balance>=0?"text-green-700":"text-red-700"),children:e.balance>=0?"I Get Back":"I Need to Pay"}),(0,n.jsxs)("p",{className:"text-2xl font-bold ".concat(e.balance>=0?"text-green-700":"text-red-700"),children:[e.balance>=0?"+":"-","$",Math.abs(e.balance).toFixed(2)]})]})]},e.memberId)),C.totals&&(0,n.jsxs)("div",{className:"mt-4 rounded-lg bg-slate-100 p-4",children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-slate-900 mb-3",children:"Trip Summary"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-600",children:"Total Expenses"}),(0,n.jsxs)("p",{className:"font-bold text-slate-900",children:[C.totals.expensesCount," items"]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-slate-600",children:"Total Amount"}),C.totals.amountByCurrency&&Object.entries(C.totals.amountByCurrency).map(e=>{let[s,t]=e;return(0,n.jsxs)("p",{className:"font-bold text-slate-900",children:[s," $",t.toFixed(2)]},s)})]})]})]})]})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Add Personal Expense"})}),(0,n.jsx)(d.aY,{children:(0,n.jsxs)("form",{onSubmit:es,className:"space-y-3",children:[(0,n.jsx)("p",{className:"text-sm text-slate-600 mb-3",children:"Personal expenses are private and not shared with the group."}),(0,n.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,n.jsx)("input",{type:"text",value:$.title,onChange:e=>V({...$,title:e.target.value}),placeholder:"Expense title",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsx)("input",{type:"number",step:"0.01",value:$.amount,onChange:e=>V({...$,amount:e.target.value}),placeholder:"Amount",required:!0,className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200"}),(0,n.jsxs)("select",{value:$.category,onChange:e=>V({...$,category:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,n.jsx)("option",{value:"food",children:"Food"}),(0,n.jsx)("option",{value:"accommodation",children:"Accommodation"}),(0,n.jsx)("option",{value:"transport",children:"Transport"}),(0,n.jsx)("option",{value:"activities",children:"Activities"}),(0,n.jsx)("option",{value:"gear",children:"Gear"}),(0,n.jsx)("option",{value:"other",children:"Other"})]}),(0,n.jsxs)("select",{value:$.currency,onChange:e=>V({...$,currency:e.target.value}),className:"rounded-lg border border-slate-200 px-4 py-2 text-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-200",children:[(0,n.jsx)("option",{value:"USD",children:"USD"}),(0,n.jsx)("option",{value:"EUR",children:"EUR"}),(0,n.jsx)("option",{value:"GBP",children:"GBP"}),(0,n.jsx)("option",{value:"INR",children:"INR"}),(0,n.jsx)("option",{value:"BDT",children:"BDT"})]})]}),(0,n.jsx)(u.z,{type:"submit",isLoading:T.isPending,children:"Add Personal Expense"})]})})]}),(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Personal Expenses"})}),(0,n.jsx)(d.aY,{children:(0,n.jsx)("div",{className:"space-y-3",children:O&&0!==O.length?O.map(e=>(0,n.jsx)("div",{className:"border-b border-slate-100 pb-3 last:border-0",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-slate-900",children:e.title}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:[e.category," \xb7 ",(0,l.WU)(new Date(e.incurredOn),"PPP")]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("p",{className:"font-semibold text-slate-900",children:[e.currency," ",e.amount.toFixed(2)]}),(0,n.jsx)("button",{onClick:()=>et(e.id),className:"text-red-600 hover:text-red-700 transition",title:"Delete expense",children:(0,n.jsx)(f.Z,{className:"h-4 w-4"})})]})]})},e.id)):(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No personal expenses recorded yet."})})})]})]})]})}),(0,n.jsx)(b,{value:"documents",children:(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Documents & Files"})}),(0,n.jsxs)(d.aY,{children:[0===N.documents.length?(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No documents uploaded yet."}):(0,n.jsx)("div",{className:"space-y-3",children:N.documents.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 pb-3 last:border-0",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-slate-900",children:e.title}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:[e.fileType,"  ",(e.fileSize/1024).toFixed(2)," KB"]})]}),(0,n.jsx)(u.z,{variant:"secondary",size:"sm",children:"Download"})]},e.id))}),(0,n.jsx)(u.z,{variant:"secondary",className:"mt-4",children:"Upload Document"})]})]})}),(0,n.jsx)(b,{value:"itinerary",children:(0,n.jsxs)(d.Zb,{children:[(0,n.jsx)(d.Ol,{children:(0,n.jsx)(d.ll,{children:"Travel Itinerary"})}),(0,n.jsxs)(d.aY,{children:[0===N.itinerary.length?(0,n.jsx)("p",{className:"text-sm text-slate-500",children:"No itinerary items yet. Add activities and events to plan your trip!"}):(0,n.jsx)("div",{className:"space-y-4",children:N.itinerary.map(e=>(0,n.jsxs)("div",{className:"border-l-4 border-primary-500 pl-4",children:[(0,n.jsx)("p",{className:"font-medium text-slate-900",children:e.title}),e.location&&(0,n.jsxs)("p",{className:"text-sm text-slate-600",children:[" ",e.location]}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:[(0,l.WU)(new Date(e.startsAt),"PPP p")," - ",(0,l.WU)(new Date(e.endsAt),"PPP p")]}),e.description&&(0,n.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:e.description})]},e.id))}),(0,n.jsx)(u.z,{variant:"secondary",className:"mt-4",children:"Add Itinerary Item"})]})]})})]})]})}}},function(e){e.O(0,[664,40,803,168,542,888,774,179],function(){return e(e.s=6877)}),_N_E=e.O()}]);