exports.id=893,exports.ids=[893],exports.modules={3386:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});var s=n(997),a=n(6689),r=n(3552),o=n(8154);function i(){let{installPrompt:e,promptInstall:t,isInstalled:n}=function(){let[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(!1),r=async()=>{if(!e)return;e.prompt();let{outcome:n}=await e.userChoice;"accepted"===n&&(t(null),s(!0))};return{installPrompt:e,promptInstall:r,isInstalled:n}}(),[i,c]=(0,a.useState)(!1),u=()=>{c(!0),localStorage.setItem("install-prompt-dismissed","true")},d=async()=>{await t(),c(!0)};return n||!e||i?null:s.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 border-t border-primary-200 bg-primary-50 p-4 shadow-lg md:bottom-4 md:left-4 md:right-auto md:max-w-md md:rounded-lg md:border",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 rounded-full bg-primary-600 p-2 text-white",children:s.jsx(r.Z,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Install Travel Management"}),s.jsx("p",{className:"mt-1 text-xs text-slate-600",children:"Add to your home screen for quick access and offline functionality"}),(0,s.jsxs)("div",{className:"mt-3 flex gap-2",children:[s.jsx("button",{onClick:d,className:"rounded-md bg-primary-600 px-4 py-2 text-xs font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:"Install App"}),s.jsx("button",{onClick:u,className:"rounded-md border border-slate-300 px-4 py-2 text-xs font-medium text-slate-700 hover:bg-slate-100 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2",children:"Not Now"})]})]}),s.jsx("button",{onClick:u,className:"flex-shrink-0 rounded-md p-1 text-slate-400 hover:bg-slate-200 hover:text-slate-600","aria-label":"Dismiss",children:s.jsx(o.Z,{className:"h-4 w-4"})})]})})}},7874:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{Q:()=>l});var a=n(997),r=n(6689),o=n(1163),i=n(3313),c=n(8176),u=n(6971),d=e([u]);function l(){let e=(0,o.useRouter)(),{isSyncing:t,pendingJobs:n}=(0,u._)(),[s,d]=(0,r.useState)(!0);return["/","/login","/signup","/auth/login","/auth/signup"].includes(e.pathname)?null:a.jsx("div",{className:"sticky top-0 z-30 w-full bg-slate-900 text-xs text-white",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl items-center justify-between px-4 py-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s?a.jsx(i.Z,{className:"h-4 w-4"}):a.jsx(c.Z,{className:"h-4 w-4 text-amber-300"}),a.jsx("span",{children:s?"Mesh connected":"Offline mode"})]}),a.jsx("span",{children:t?"Syncing...":n>0?`${n} pending changes`:"All changes synced"})]})})}u=(d.then?(await d)():d)[0],s()}catch(e){s(e)}})},8111:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{H:()=>d,a:()=>l});var a=n(997),r=n(6689),o=n(6091),i=e([o]);o=(i.then?(await i)():i)[0];let c=(0,r.createContext)(void 0),u=()=>null,d=({children:e})=>{let[t,n]=(0,r.useState)({user:null,accessToken:null,refreshToken:null,loading:!0}),s=(0,r.useCallback)((e,t)=>{n(n=>({...n,accessToken:e,refreshToken:t}))},[]),i=(0,r.useCallback)(()=>{n(e=>({...e,accessToken:null,refreshToken:null}))},[]),d=(0,r.useCallback)(async e=>{let t=await (0,o.S)("/auth/me",{accessToken:e});n(e=>({...e,user:t}))},[]),l=(0,r.useCallback)(async()=>{if(!t.refreshToken)return null;let e=await (0,o.S)("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:t.refreshToken}),accessToken:null});return s(e.accessToken,e.refreshToken),e.accessToken},[s,t.refreshToken]);(0,r.useEffect)(()=>{let e=!0;return(async()=>{let t=u();if(t?.accessToken&&t?.refreshToken){if(!e)return;n(e=>({...e,accessToken:t.accessToken,refreshToken:t.refreshToken}));try{await d(t.accessToken)}catch(t){console.warn("Failed to restore session, clearing tokens.",t),e&&(i(),n(e=>({...e,user:null})))}}e&&n(e=>({...e,loading:!1}))})(),()=>{e=!1}},[i,d]);let y=(0,r.useCallback)(async(e,t)=>{let n=await (0,o.S)("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});s(n.accessToken,n.refreshToken),await d(n.accessToken)},[d,s]),p=(0,r.useCallback)(async e=>{await (0,o.S)("/auth/signup",{method:"POST",body:JSON.stringify(e)}),await y(e.email,e.password)},[y]),g=(0,r.useCallback)(()=>{i(),n({user:null,accessToken:null,refreshToken:null,loading:!1})},[i]),m=(0,r.useCallback)(async()=>{t.accessToken&&await d(t.accessToken)},[d,t.accessToken]),h=(0,r.useCallback)(async(e,n={})=>{try{return await (0,o.S)(e,{...n,accessToken:t.accessToken})}catch(t){if(t?.status===401){let t=await l();if(t)return(0,o.S)(e,{...n,accessToken:t});g()}throw t}},[g,l,t.accessToken]),f=(0,r.useMemo)(()=>({...t,login:y,signup:p,logout:g,refreshProfile:m,authFetch:h}),[h,y,g,m,p,t]);return a.jsx(c.Provider,{value:f,children:e})},l=()=>{let e=(0,r.useContext)(c);if(!e)throw Error("useAuth must be used within an AuthProvider");return e};s()}catch(e){s(e)}})},6971:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{_:()=>d});var a=n(6689),r=n(8111),o=n(6091),i=n(578),c=n(2003),u=e([r,o,i]);function d(){let{accessToken:e}=(0,r.a)(),{syncQueue:t,markJobSynced:n,markJobFailed:s}=(0,i.q)(),[u,d]=(0,a.useState)(!1),[l,y]=(0,a.useState)(!0),p=async()=>{if(!u&&l&&e){d(!0),console.log("[OfflineSync] Starting sync...");try{let a=await c.N.getPendingSyncItems();for(let t of(console.log(`[OfflineSync] Found ${a.length} items in IndexedDB queue`),a))try{await (0,o.S)(t.url,{method:t.method,accessToken:e,body:t.body?JSON.stringify(t.body):void 0}),await c.N.markSyncItemComplete(t.id),console.log(`[OfflineSync] Synced item ${t.id}`)}catch(e){console.error(`[OfflineSync] Failed to sync item ${t.id}:`,e),await c.N.markSyncItemFailed(t.id)}for(let a of t.filter(e=>"pending"===e.status))try{await (0,o.S)(`/sync/${a.entity}`,{method:"POST",accessToken:e,body:JSON.stringify(a.payload)}),n(a.id),console.log(`[OfflineSync] Synced job ${a.id}`)}catch(e){console.error(`[OfflineSync] Failed to sync job ${a.id}:`,e),s(a.id,e?.message??"Unknown error")}console.log("[OfflineSync] Sync complete")}catch(e){console.error("[OfflineSync] Sync error:",e)}finally{d(!1)}}};return{isSyncing:u,isOnline:l,pendingJobs:t.filter(e=>"pending"===e.status).length,syncNow:p}}[r,o,i]=u.then?(await u)():u,s()}catch(e){s(e)}})},6717:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{n:()=>o}),n(6689);var a=n(578),r=e([a]);function o(){let{groups:e,addGroup:t}=(0,a.q)()}a=(r.then?(await r)():r)[0],process.env.NEXT_PUBLIC_ENABLE_DEMO_DATA,s()}catch(e){s(e)}})},6091:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{E:()=>i,S:()=>o});var a=n(9752),r=e([a]);async function o(e,t={}){let n=new Headers(t.headers||{});t.skipAuthHeaders||n.has("Content-Type")||!t.body||t.body instanceof FormData||n.set("Content-Type","application/json"),t.accessToken&&n.set("Authorization",`Bearer ${t.accessToken}`);let s=await fetch(`https://travel-management-backend-ecxc.onrender.com${e}`,{...t,headers:n}),a=s.headers.get("content-type"),r=a?.includes("application/json")?await s.json():await s.text();if(!s.ok){let e="string"==typeof r?{message:r}:r;throw e.status=s.status,e}return r}let i=new(a=(r.then?(await r)():r)[0]).QueryClient({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:3e4}}});s()}catch(e){s(e)}})},2003:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});let s={groups:"groups",expenses:"expenses",members:"members",documents:"documents",syncQueue:"syncQueue",tripPackages:"tripPackages"};class a{async init(){return new Promise((e,t)=>{let n=indexedDB.open("TravelManagementDB",1);n.onerror=()=>{console.error("[OfflineDB] Error opening database"),t(n.error)},n.onsuccess=()=>{this.db=n.result,console.log("[OfflineDB] Database opened successfully"),e()},n.onupgradeneeded=e=>{let t=e.target.result;if(console.log("[OfflineDB] Upgrading database..."),t.objectStoreNames.contains(s.groups)||t.createObjectStore(s.groups,{keyPath:"id"}).createIndex("updatedAt","updatedAt",{unique:!1}),t.objectStoreNames.contains(s.expenses)||t.createObjectStore(s.expenses,{keyPath:"id"}).createIndex("groupId","groupId",{unique:!1}),t.objectStoreNames.contains(s.members)||t.createObjectStore(s.members,{keyPath:"id"}).createIndex("groupId","groupId",{unique:!1}),t.objectStoreNames.contains(s.documents)||t.createObjectStore(s.documents,{keyPath:"id"}).createIndex("groupId","ownerId",{unique:!1}),!t.objectStoreNames.contains(s.syncQueue)){let e=t.createObjectStore(s.syncQueue,{keyPath:"id",autoIncrement:!0});e.createIndex("status","status",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1})}t.objectStoreNames.contains(s.tripPackages)||t.createObjectStore(s.tripPackages,{keyPath:"groupId"}).createIndex("downloadedAt","downloadedAt",{unique:!1}),console.log("[OfflineDB] Database upgrade complete")}})}async get(e,t){return this.db||await this.init(),new Promise((n,s)=>{let a=this.db.transaction([e],"readonly").objectStore(e).get(t);a.onsuccess=()=>n(a.result),a.onerror=()=>s(a.error)})}async getAll(e){return this.db||await this.init(),new Promise((t,n)=>{let s=this.db.transaction([e],"readonly").objectStore(e).getAll();s.onsuccess=()=>t(s.result),s.onerror=()=>n(s.error)})}async getByIndex(e,t,n){return this.db||await this.init(),new Promise((s,a)=>{let r=this.db.transaction([e],"readonly").objectStore(e).index(t).getAll(n);r.onsuccess=()=>s(r.result),r.onerror=()=>a(r.error)})}async put(e,t){return this.db||await this.init(),new Promise((n,s)=>{let a=this.db.transaction([e],"readwrite").objectStore(e).put(t);a.onsuccess=()=>n(),a.onerror=()=>s(a.error)})}async delete(e,t){return this.db||await this.init(),new Promise((n,s)=>{let a=this.db.transaction([e],"readwrite").objectStore(e).delete(t);a.onsuccess=()=>n(),a.onerror=()=>s(a.error)})}async clear(e){return this.db||await this.init(),new Promise((t,n)=>{let s=this.db.transaction([e],"readwrite").objectStore(e).clear();s.onsuccess=()=>t(),s.onerror=()=>n(s.error)})}async addToSyncQueue(e){let t={...e,status:"pending",createdAt:new Date().toISOString(),retries:0};if(await this.put(s.syncQueue,t),console.log("[OfflineDB] Added to sync queue:",t),"serviceWorker"in navigator&&"SyncManager"in window)try{let e=await navigator.serviceWorker.ready;await e.sync.register("sync-queue"),console.log("[OfflineDB] Registered background sync")}catch(e){console.log("[OfflineDB] Background sync not supported")}}async getPendingSyncItems(){return this.getByIndex(s.syncQueue,"status","pending")}async markSyncItemComplete(e){let t=await this.get(s.syncQueue,e);t&&await this.put(s.syncQueue,{...t,status:"completed"})}async markSyncItemFailed(e){let t=await this.get(s.syncQueue,e);t&&await this.put(s.syncQueue,{...t,status:"failed",retries:(t.retries||0)+1})}constructor(){this.db=null}}let r=new a},3893:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{default:()=>m});var a=n(997),r=n(968),o=n.n(r);n(6689);var i=n(9752),c=n(8111),u=n(6091),d=n(7874),l=n(3386),y=n(6717);n(108),n(9637);var p=e([i,c,u,d,y]);function g({children:e}){return(0,y.n)(),a.jsx(a.Fragment,{children:e})}function m({Component:e,pageProps:t}){return a.jsx(i.QueryClientProvider,{client:u.E,children:a.jsx(c.H,{children:(0,a.jsxs)(g,{children:[(0,a.jsxs)(o(),{children:[a.jsx("title",{children:"Travel Management"}),a.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes"}),a.jsx("meta",{name:"description",content:"Coordinate group trips, manage expenses, and stay connected even when offline"})]}),a.jsx(d.Q,{}),a.jsx(l.s,{}),a.jsx(e,{...t})]})})})}[i,c,u,d,y]=p.then?(await p)():p,s()}catch(e){s(e)}})},578:(e,t,n)=>{"use strict";n.a(e,async(e,s)=>{try{n.d(t,{q:()=>l});var a=n(6912),r=n(3602),o=n(3182),i=n.n(o),c=n(5611),u=e([a,r,c]);[a,r,c]=u.then?(await u)():u;let d={groups:{},syncQueue:[],notifications:[{channel:"push",enabled:!0},{channel:"email",enabled:!0},{channel:"sms",enabled:!1},{channel:"in-app",enabled:!0}],lastSyncedAt:void 0},l=(0,a.create)()((0,r.devtools)((0,r.persist)((e,t)=>({...d,setGroups:t=>{let n=t.reduce((e,t)=>(e[t.id]=t,e),{});e(e=>({...e,groups:n}))},setGroup:t=>{e(e=>({...e,groups:{...e.groups,[t.id]:t}}))},addGroup:n=>{let s=n.id??(0,c.nanoid)(),a=new Date().toISOString(),r={...n,id:s,createdAt:n.createdAt??a,updatedAt:a,financeSummary:n.financeSummary??{totalExpenses:n.expenses?.reduce((e,t)=>e+t.amount,0)??0,totalMembers:n.members?.length??0,outstandingBalance:0},expenses:n.expenses??[],documents:n.documents??[],itinerary:n.itinerary??[],offlinePackages:n.offlinePackages??[],emergencyContacts:n.emergencyContacts??[],invites:n.invites??[],members:n.members??[]};return e(e=>({groups:{...e.groups,[s]:r},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"create",entity:"group",payload:r,createdAt:a,status:"pending"}]})),t().groups[s]},updateGroup:(t,n)=>{e(e=>{let s=e.groups[t];if(!s)return e;let a={...s,...n,updatedAt:new Date().toISOString()};return{...e,groups:{...e.groups,[t]:a},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"update",entity:"group",payload:{id:t,...n},createdAt:new Date().toISOString(),status:"pending"}]}})},removeGroup:t=>{e(e=>{if(!e.groups[t])return e;let{[t]:n,...s}=e.groups;return{...e,groups:s,syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"delete",entity:"group",payload:{id:t},createdAt:new Date().toISOString(),status:"pending"}]}})},addExpense:(t,n)=>{let s={id:(0,c.nanoid)(),createdAt:new Date().toISOString(),...n};return e(e=>{let n=e.groups[t];if(!n)return e;let a=[s,...n.expenses],r=a.reduce((e,t)=>e+t.amount,0);return{...e,groups:{...e.groups,[t]:{...n,expenses:a,financeSummary:{...n.financeSummary,totalExpenses:r,outstandingBalance:Math.max(0,r-a.reduce((e,t)=>e+t.splits.reduce((e,t)=>e+t.amount,0),0))},updatedAt:new Date().toISOString()}},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"create",entity:"expense",payload:{groupId:t,expense:s},createdAt:new Date().toISOString(),status:"pending"}]}}),s},removeExpense:(t,n)=>{e(e=>{let s=e.groups[t];if(!s)return e;let a=s.expenses.filter(e=>e.id!==n),r=a.reduce((e,t)=>e+t.amount,0);return{...e,groups:{...e.groups,[t]:{...s,expenses:a,financeSummary:{...s.financeSummary,totalExpenses:r},updatedAt:new Date().toISOString()}},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"delete",entity:"expense",payload:{groupId:t,expenseId:n},createdAt:new Date().toISOString(),status:"pending"}]}})},addDocument:(t,n)=>{let s={id:(0,c.nanoid)(),createdAt:new Date().toISOString(),...n};return e(e=>{let n=e.groups[t];return n?{...e,groups:{...e.groups,[t]:{...n,documents:[s,...n.documents],updatedAt:new Date().toISOString()}},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"create",entity:"document",payload:{groupId:t,document:s},createdAt:new Date().toISOString(),status:"pending"}]}:e}),s},removeDocument:(t,n)=>{e(e=>{let s=e.groups[t];return s?{...e,groups:{...e.groups,[t]:{...s,documents:s.documents.filter(e=>e.id!==n),updatedAt:new Date().toISOString()}},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"delete",entity:"document",payload:{groupId:t,documentId:n},createdAt:new Date().toISOString(),status:"pending"}]}:e})},addItineraryItem:(t,n)=>{let s={id:(0,c.nanoid)(),...n};return e(e=>{let n=e.groups[t];return n?{...e,groups:{...e.groups,[t]:{...n,itinerary:[...n.itinerary,s].sort((e,t)=>new Date(e.startsAt).getTime()-new Date(t.startsAt).getTime()),updatedAt:new Date().toISOString()}},syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),type:"create",entity:"itinerary",payload:{groupId:t,item:s},createdAt:new Date().toISOString(),status:"pending"}]}:e}),s},updateOfflinePackage:(t,n)=>{e(e=>{let s=e.groups[t];if(!s)return e;let a=[...s.offlinePackages],r=a.findIndex(e=>e.id===n.id);return r>=0?a[r]=n:a.push(n),{...e,groups:{...e.groups,[t]:{...s,offlinePackages:a,updatedAt:new Date().toISOString()}}}})},enqueueSync:t=>{e(e=>({...e,syncQueue:[...e.syncQueue,{id:(0,c.nanoid)(),createdAt:new Date().toISOString(),status:"pending",...t}]}))},markJobSynced:t=>{e(e=>({...e,syncQueue:e.syncQueue.map(e=>e.id===t?{...e,status:"synced",lastTriedAt:new Date().toISOString()}:e),lastSyncedAt:new Date().toISOString()}))},markJobFailed:(t,n)=>{e(e=>({...e,syncQueue:e.syncQueue.map(e=>e.id===t?{...e,status:"failed",error:n,lastTriedAt:new Date().toISOString()}:e)}))},setNotifications:t=>{e({notifications:t})},reset:()=>{e(d)}}),{name:"travel-management-app",storage:(0,r.createJSONStorage)(()=>i()),partialize:e=>({groups:e.groups,syncQueue:e.syncQueue,notifications:e.notifications,lastSyncedAt:e.lastSyncedAt})})));s()}catch(e){s(e)}})},108:()=>{}};